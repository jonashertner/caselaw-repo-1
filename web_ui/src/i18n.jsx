import React, { createContext, useContext, useState, useCallback } from 'react';

export const LANGS = ['de', 'fr', 'it', 'rm'];

const translations = {
  de: {
    'header.subtitle': 'Schweizer Gerichtsentscheide',
    'empty.title': 'Schweizer Rechtsprechung durchsuchen',
    'empty.desc': 'Durchsuchen Sie \u00fcber 1 Million Gerichtsentscheide in nat\u00fcrlicher Sprache',
    'input.placeholder': 'Fragen zur Schweizer Rechtsprechung\u2026',
    'results.heading': 'Entscheide',
    'results.empty': 'Suchergebnisse erscheinen hier.',
    'results.source': 'Quelle anzeigen',
    'results.fulltext': 'Volltext',
    'results.loading': 'Volltext wird geladen\u2026',
    'results.loadError': 'Fehler beim Laden',
    'btn.filters': 'Filter',
    'btn.new': 'Neue Sitzung',
    'btn.settings': 'Einstellungen',
    'btn.theme': 'Erscheinungsbild wechseln',
    'btn.export': 'Gespr\u00e4ch exportieren',
    'btn.send': 'Senden',
    'btn.stop': 'Stopp',
    'filter.court': 'Gericht',
    'filter.canton': 'Kanton',
    'filter.language': 'Sprache',
    'filter.from': 'Von',
    'filter.to': 'Bis',
    'filter.all': 'Alle',
    'filter.collapse': 'Duplikate zusammenfassen',
    'filter.multilingual': 'Mehrsprachig',
    'filter.reset': 'Zur\u00fccksetzen',
    'settings.title': 'API-Schl\u00fcssel',
    'settings.notConfigured': 'Nicht konfiguriert',
    'settings.save': 'Speichern',
    'settings.remove': 'Entfernen',
    'settings.getKey': 'Schl\u00fcssel erhalten bei',
    'settings.replaceKey': 'Neuen Schl\u00fcssel eingeben',
    'settings.ollamaTitle': 'Lokale Modelle (Ollama)',
    'settings.ollamaConnected': 'Verbunden',
    'settings.ollamaOffline': 'Nicht erreichbar',
    'settings.ollamaHelp': 'Installieren Sie Ollama von',
    'banner.noKeys': 'Kein Anbieter konfiguriert.',
    'banner.openSettings': 'Einstellungen \u00f6ffnen',
    'banner.toAdd': 'um einen API-Schl\u00fcssel oder Ollama einzurichten.',
    'role.user': 'Benutzer',
    'role.assistant': 'Assistent',
    'export.title': 'Rechtsprechungsergebnisse',
    'suggestion.0': 'Urteile zum Mietrecht mit Bezug auf Art. 271 OR',
    'suggestion.1': 'BGer-Entscheide zur K\u00fcndigung im Arbeitsrecht',
    'suggestion.2': 'Bundesgerichtsentscheide zum Datenschutz seit 2020',
  },
  fr: {
    'header.subtitle': 'Jurisprudence suisse',
    'empty.title': 'Rechercher la jurisprudence suisse',
    'empty.desc': 'Recherchez parmi plus d\u2019un million de d\u00e9cisions de justice en langage naturel',
    'input.placeholder': 'Posez une question sur la jurisprudence suisse\u2026',
    'results.heading': 'D\u00e9cisions',
    'results.empty': 'Les r\u00e9sultats appara\u00eetront ici.',
    'results.source': 'Voir la source',
    'results.fulltext': 'Texte int\u00e9gral',
    'results.loading': 'Chargement du texte\u2026',
    'results.loadError': '\u00c9chec du chargement',
    'btn.filters': 'Filtres',
    'btn.new': 'Nouvelle session',
    'btn.settings': 'Param\u00e8tres',
    'btn.theme': 'Changer le th\u00e8me',
    'btn.export': 'Exporter la conversation',
    'btn.send': 'Envoyer',
    'btn.stop': 'Arr\u00eater',
    'filter.court': 'Tribunal',
    'filter.canton': 'Canton',
    'filter.language': 'Langue',
    'filter.from': 'Du',
    'filter.to': 'Au',
    'filter.all': 'Toutes',
    'filter.collapse': 'Regrouper les doublons',
    'filter.multilingual': 'Multilingue',
    'filter.reset': 'R\u00e9initialiser',
    'settings.title': 'Cl\u00e9s API',
    'settings.notConfigured': 'Non configur\u00e9',
    'settings.save': 'Enregistrer',
    'settings.remove': 'Supprimer',
    'settings.getKey': 'Obtenez votre cl\u00e9 sur',
    'settings.replaceKey': 'Entrer une nouvelle cl\u00e9',
    'settings.ollamaTitle': 'Mod\u00e8les locaux (Ollama)',
    'settings.ollamaConnected': 'Connect\u00e9',
    'settings.ollamaOffline': 'Inaccessible',
    'settings.ollamaHelp': 'Installez Ollama depuis',
    'banner.noKeys': 'Aucun fournisseur configur\u00e9.',
    'banner.openSettings': 'Ouvrir les param\u00e8tres',
    'banner.toAdd': 'pour ajouter une cl\u00e9 API ou configurer Ollama.',
    'role.user': 'Utilisateur',
    'role.assistant': 'Assistant',
    'export.title': 'R\u00e9sultats de jurisprudence',
    'suggestion.0': 'Arr\u00eats du TF sur le droit du bail',
    'suggestion.1': 'D\u00e9cisions du TF sur le licenciement en droit du travail',
    'suggestion.2': 'Arr\u00eats sur la protection des donn\u00e9es depuis 2020',
  },
  it: {
    'header.subtitle': 'Giurisprudenza svizzera',
    'empty.title': 'Cerca nella giurisprudenza svizzera',
    'empty.desc': 'Cerca tra oltre 1 milione di decisioni giudiziarie in linguaggio naturale',
    'input.placeholder': 'Chiedi sulla giurisprudenza svizzera\u2026',
    'results.heading': 'Decisioni',
    'results.empty': 'I risultati appariranno qui.',
    'results.source': 'Vedi fonte',
    'results.fulltext': 'Testo integrale',
    'results.loading': 'Caricamento del testo\u2026',
    'results.loadError': 'Errore di caricamento',
    'btn.filters': 'Filtri',
    'btn.new': 'Nuova sessione',
    'btn.settings': 'Impostazioni',
    'btn.theme': 'Cambia tema',
    'btn.export': 'Esporta conversazione',
    'btn.send': 'Invia',
    'btn.stop': 'Ferma',
    'filter.court': 'Tribunale',
    'filter.canton': 'Cantone',
    'filter.language': 'Lingua',
    'filter.from': 'Dal',
    'filter.to': 'Al',
    'filter.all': 'Tutte',
    'filter.collapse': 'Raggruppa duplicati',
    'filter.multilingual': 'Multilingue',
    'filter.reset': 'Reimposta',
    'settings.title': 'Chiavi API',
    'settings.notConfigured': 'Non configurato',
    'settings.save': 'Salva',
    'settings.remove': 'Rimuovi',
    'settings.getKey': 'Ottieni la chiave su',
    'settings.replaceKey': 'Inserisci nuova chiave',
    'settings.ollamaTitle': 'Modelli locali (Ollama)',
    'settings.ollamaConnected': 'Connesso',
    'settings.ollamaOffline': 'Non raggiungibile',
    'settings.ollamaHelp': 'Installa Ollama da',
    'banner.noKeys': 'Nessun fornitore configurato.',
    'banner.openSettings': 'Apri impostazioni',
    'banner.toAdd': 'per aggiungere una chiave API o configurare Ollama.',
    'role.user': 'Utente',
    'role.assistant': 'Assistente',
    'export.title': 'Risultati di giurisprudenza',
    'suggestion.0': 'Sentenze del TF sul diritto di locazione',
    'suggestion.1': 'Decisioni del TF sul licenziamento nel diritto del lavoro',
    'suggestion.2': 'Sentenze sulla protezione dei dati dal 2020',
  },
  rm: {
    'header.subtitle': 'Decisiuns giudizialas svizras',
    'empty.title': 'Tschertgar la giurisprudenza svizra',
    'empty.desc': 'Tschertgai en pli che 1 milliun decisiuns giudizialas en lingua natirala',
    'input.placeholder': 'Dumondai davart il dretg svizzer\u2026',
    'results.heading': 'Decisiuns',
    'results.empty': 'Ils resultats da tschertga cumparan qua.',
    'results.source': 'Mussar la funtauna',
    'results.fulltext': 'Text cumplain',
    'results.loading': 'Chargiar il text\u2026',
    'results.loadError': 'Errur dal chargiar',
    'btn.filters': 'Filters',
    'btn.new': 'Nova sessiun',
    'btn.settings': 'Parameters',
    'btn.theme': 'Midar il design',
    'btn.export': 'Exportar la conversaziun',
    'btn.send': 'Trametter',
    'btn.stop': 'Fermar',
    'filter.court': 'Tribunal',
    'filter.canton': 'Chantun',
    'filter.language': 'Lingua',
    'filter.from': 'Da',
    'filter.to': 'Enfin',
    'filter.all': 'Tuttas',
    'filter.collapse': 'Resumar duplicats',
    'filter.multilingual': 'Pluriling',
    'filter.reset': 'Redefinir',
    'settings.title': 'Clavs API',
    'settings.notConfigured': 'Betg configur\u00e0',
    'settings.save': 'Memorisar',
    'settings.remove': 'Allontanar',
    'settings.getKey': 'Retschaiver la clav sin',
    'settings.replaceKey': 'Endatar nova clav',
    'settings.ollamaTitle': 'Models locals (Ollama)',
    'settings.ollamaConnected': 'ConnectÃ ',
    'settings.ollamaOffline': 'Betg cuntanschi',
    'settings.ollamaHelp': 'Installai Ollama da',
    'banner.noKeys': 'Nagin purschider configur\u00e0.',
    'banner.openSettings': 'Avrir ils parameters',
    'banner.toAdd': 'per agiuntar ina clav API u configurar Ollama.',
    'role.user': 'Utilisader',
    'role.assistant': 'Assistent',
    'export.title': 'Resultats da giurisprudenza',
    'suggestion.0': 'Decisiuns dal TF davart il dretg da localitad',
    'suggestion.1': 'Decisiuns dal TF davart la disditga en il dretg da lavur',
    'suggestion.2': 'Decisiuns davart la protecziun da datas dapi 2020',
  },
};

const I18nContext = createContext();

export function I18nProvider({ children }) {
  const [lang, setLangState] = useState(() => {
    const saved = localStorage.getItem('ui-lang');
    if (saved && LANGS.includes(saved)) return saved;
    const browser = (navigator.language || '').toLowerCase().split('-')[0];
    if (LANGS.includes(browser)) return browser;
    return 'de';
  });

  const setLang = useCallback((l) => {
    setLangState(l);
    localStorage.setItem('ui-lang', l);
    document.documentElement.lang = l;
  }, []);

  const t = useCallback((key) => {
    return translations[lang]?.[key] || translations.de[key] || key;
  }, [lang]);

  return (
    <I18nContext.Provider value={{ lang, setLang, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}
